/*!CK:3168591889!*//*1398779966,178141991*/

if (self.CavalryLogger) { CavalryLogger.start_js(["B8xZh"]); }

__d("DevsiteURLChanger",["URI"],function(a,b,c,d,e,f,g){var h={changeURL:function(i){var j=(new g(location.href)).getFragment();if(j)j='#'+j;window.history.replaceState(window.history.state,'',i+j);}};e.exports=h;});
__d("StarRatingDialog",["Animation","Arbiter","AsyncRequest","CSS","DOM","Parent","Style","SubscriptionsHandler","Vector","reportData","csx","cx","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(w,x){"use strict";this.endpoint=x.endpoint;this.clickEndpoint=x.click_endpoint;this.showOnload=false;this.done=false;this.entrance=x.entrance;this.completed=0;this.sessionID=x.session_id;this.showInstructions(w);}t.prototype.cleanUp=function(){"use strict";this.listeners&&this.listeners.release();this.count=0;this.storyBuffer&&this.storyBuffer.forEach(function(w){w&&k.remove(w);});this.currentStory&&k.remove(this.currentStory);this.showOnload=false;this.storyBuffer=null;this.currentStory=null;this.counts=0;this.progress=null;this.done=false;};t.prototype.insertContent=function(w,x){"use strict";k.appendContent(this.dialogBody,w);this.storyBuffer=k.scry(this.root,"._5hdp");this.currentStory=k.find(this.root,"._5hdq");this.counts=k.find(this.root,"._5hdn");this.progress=k.find(this.root,"._5cp5");if(this.showOnload){this.showStarContent();this.showOnload=false;}else this.showOnload=true;this.listeners.addSubscriptions(h.subscribe('starRatingDialogQuestions/finished',this.onClick.bind(this)));};t.prototype.showStarContent=function(){"use strict";this.showNextStory(function(){k.remove(k.find(this.root,"._5hlo"));k.remove(k.find(this.root,"._5hlp"));this.dialogJS.setWidth(650);j.removeClass(this.dialogBody,"_5hdo");this.updateOverlayHeight();this.dialogJS.updatePosition();}.bind(this));};t.prototype.onClick=function(event,w){"use strict";var x=l.byClass(w[0].target,"_5hdp"),y=k.find(x,"._2m2y");this.saveSelection(w,JSON.parse(y.getAttribute('data-story')));if(this.count<this.total){this.showNextStory();}else this.done=true;};t.prototype.showNextStory=function(w){"use strict";new g(this.currentStory).from('opacity',1).to('opacity',0).duration(150).ondone(function(){k.setContent(this.currentStory,this.storyBuffer.shift());new g(this.currentStory).from('opacity',0).to('opacity',1).duration(200).go();this.updateProgressBar();this.updateOverlayHeight();w&&w();h.inform('starRatingSurvey/clickProcessed');}.bind(this)).go();};t.prototype.showInstructions=function(w){"use strict";if(!this.dialogJS){this.dialogJS=w;this.root=w.getInnerContent();this.dialogBody=k.find(this.root,"._5hdt");this.dialogJS.subscribeOnce('cancel',this.cleanUp.bind(this));}this.listenToSubmit();this.listeners=new n();new i(this.endpoint).setData({load_stories:true,survey_completed:this.completed,session_id:this.sessionID}).send();};t.prototype.renderContent=function(w,x){"use strict";this.count=0;this.total=x.final_count;this.insertContent(w,x);};t.prototype.finishedPage=function(w,x){"use strict";this.cleanUp();this.finished=true;this.completed+=1;j.addClass(this.dialogBody,"_5hdo");this.dialogJS.setWidth(445);k.setContent(this.dialogBody,w);k.appendContent(this.root,x);this.dialogJS.updatePosition();this.showInstructions(this.dialogBody);};t.prototype.listenToSubmit=function(){"use strict";this.dialogJS.subscribeOnce('confirm',function(w,x){j.addClass(x,"_42fr");if(this.showOnload){this.showOnload=false;this.showStarContent();}else{this.showOnload=true;var y=k.find(this.root,"._5hdu");j.show(y);}}.bind(this));};t.prototype.saveSelection=function(w,x){"use strict";if(this.done)return;if(x.type=='feed_story'){var y={mf_story_key:x.viewstate_id,qid:x.qid},z="star"+w[0].rating;p(z,{ft:y});}x.survey_completed=this.completed;x.count=this.count;x.score=w[0].rating;x.sel_time=w[0].sel_time;x.sel_time_ms=w[0].sel_time_ms;x.final_count=this.total;x.ego_conv_context=this.ego_conv_context;x.entrance=this.entrance;x.session_id=this.sessionID;if(w.length>1){x.second_score=w[1].rating;x.second_sel_time=w[1].sel_time;x.second_sel_time_ms=w[1].sel_time_ms;}new i(this.clickEndpoint).setData(x).send();};t.prototype.updateOverlayHeight=function(){"use strict";var w=k.find(this.currentStory,"._5hdv"),x=o.getElementDimensions(w).y,y=k.find(this.currentStory,"._5hdw");m.set(y,'height',x+'px');};t.prototype.updateProgressBar=function(){"use strict";this.count++;m.set(this.progress,'width',this.count/this.total*100+'%');k.setContent(this.counts,s._("{count} of {total}",{count:k.create('span',{className:"_5cp2"},this.count),total:k.create('span',{className:"_5cp3"},this.total)}));};var u,v={init:function(w,x){u=new t(w,x);},renderContent:function(w,x){u.renderContent(w,x);},finishedPage:function(w,x){u.finishedPage(w,x);}};e.exports=v;});